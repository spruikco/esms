{% extends "base.html" %}

{% block title %}Submit Lineup - {{ match.home_team.name }} vs {{ match.away_team.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Submit Lineup</h1>
    <h3>{{ match.home_team.name }} vs {{ match.away_team.name }}</h3>
    <p class="text-muted">Match scheduled for: {{ match.scheduled_time.strftime('%Y-%m-%d %H:%M') }}</p>
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div class="row mt-4">
        <!-- Team selector tabs -->
        <ul class="nav nav-tabs" id="teamTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">
                    {{ home_team.name }} (Home)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="away-tab" data-bs-toggle="tab" data-bs-target="#away" type="button" role="tab" aria-controls="away" aria-selected="false">
                    {{ away_team.name }} (Away)
                </button>
            </li>
        </ul>
        
        <!-- Tab content -->
        <div class="tab-content" id="teamTabsContent">
            <!-- Home Team Lineup -->
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                <div class="card">
                    <div class="card-body">
                        <form method="post" action="{{ url_for('submit_lineup', match_id=match.id) }}">
                            <input type="hidden" name="team_id" value="{{ home_team.id }}">
                            
                            <div class="form-group mb-4">
                                <label for="home-tactic">Tactic</label>
                                <select class="form-control" id="home-tactic" name="tactic">
                                    <option value="N" {% if home_team.tactic == 'N' %}selected{% endif %}>Normal</option>
                                    <option value="A" {% if home_team.tactic == 'A' %}selected{% endif %}>Attacking</option>
                                    <option value="D" {% if home_team.tactic == 'D' %}selected{% endif %}>Defensive</option>
                                    <option value="P" {% if home_team.tactic == 'P' %}selected{% endif %}>Possession</option>
                                    <option value="C" {% if home_team.tactic == 'C' %}selected{% endif %}>Counter</option>
                                </select>
                            </div>
                            
                            <h4>Starting Lineup</h4>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Position</th>
                                        <th>Player</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for pos in ['GK', 'LB', 'CB', 'RB', 'DM', 'CM', 'LM', 'RM', 'AM', 'LW', 'RW', 'ST'] %}
                                    <tr>
                                        <td>{{ pos }}</td>
                                        <td>
                                            <select name="player_pos_{{ pos }}" class="form-control">
                                                <option value="">-- Select Player --</option>
                                                {% for tp in home_team.players %}
                                                {% set player = tp.player %}
                                                <option value="{{ player.id }}" {% if tp.position == pos %}selected{% endif %}>
                                                    {{ player.name }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                            <div class="mt-3">
                                <button type="submit" class="btn btn-primary">Submit Lineup</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Away Team Lineup -->
            <div class="tab-pane fade" id="away" role="tabpanel" aria-labelledby="away-tab">
                <div class="card">
                    <div class="card-body">
                        <form method="post" action="{{ url_for('submit_lineup', match_id=match.id) }}">
                            <input type="hidden" name="team_id" value="{{ away_team.id }}">
                            
                            <div class="form-group mb-4">
                                <label for="away-tactic">Tactic</label>
                                <select class="form-control" id="away-tactic" name="tactic">
                                    <option value="N" {% if away_team.tactic == 'N' %}selected{% endif %}>Normal</option>
                                    <option value="A" {% if away_team.tactic == 'A' %}selected{% endif %}>Attacking</option>
                                    <option value="D" {% if away_team.tactic == 'D' %}selected{% endif %}>Defensive</option>
                                    <option value="P" {% if away_team.tactic == 'P' %}selected{% endif %}>Possession</option>
                                    <option value="C" {% if away_team.tactic == 'C' %}selected{% endif %}>Counter</option>
                                </select>
                            </div>
                            
                            <h4>Starting Lineup</h4>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Position</th>
                                        <th>Player</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for pos in ['GK', 'LB', 'CB', 'RB', 'DM', 'CM', 'LM', 'RM', 'AM', 'LW', 'RW', 'ST'] %}
                                    <tr>
                                        <td>{{ pos }}</td>
                                        <td>
                                            <select name="player_pos_{{ pos }}" class="form-control">
                                                <option value="">-- Select Player --</option>
                                                {% for tp in away_team.players %}
                                                {% set player = tp.player %}
                                                <option value="{{ player.id }}" {% if tp.position == pos %}selected{% endif %}>
                                                    {{ player.name }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            
                            <div class="mt-3">
                                <button type="submit" class="btn btn-primary">Submit Lineup</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mt-4">
        <a href="{{ url_for('match_detail', match_id=match.id) }}" class="btn btn-secondary">Back to Match Details</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Bootstrap tab functionality if not using Bootstrap's JS
    const tabButtons = document.querySelectorAll('[data-bs-toggle="tab"]');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Hide all tab panes
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('show', 'active');
            });
            
            // Deactivate all tab buttons
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
            });
            
            // Activate clicked tab
            this.classList.add('active');
            this.setAttribute('aria-selected', 'true');
            
            // Show corresponding tab pane
            const target = document.querySelector(this.getAttribute('data-bs-target'));
            if (target) {
                target.classList.add('show', 'active');
            }
        });
    });
});
</script>
{% endblock %}